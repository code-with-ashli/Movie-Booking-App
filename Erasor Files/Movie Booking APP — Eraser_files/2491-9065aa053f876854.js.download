"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2491],{24192:function(e,t,n){n.d(t,{O:function(){return s}});var r=n(2784),o=n(9605),u=n(89271),a=n(66924);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},u=Object.keys(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function s(){var e=(0,o.Z)(),t=(0,r.useCallback)((function(t){var n=(0,u.E)(t,"Unknown",{}),r=n.error,o=c(n,["error"]);if(!1!==r.isSevere&&e.error(r.message,{id:r.message}),!r.handled){var s=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){i(e,t,n[t])}))}return e}({},o,{cause:r.cause});(0,a.Tb)(r,{extra:s})}}),[]);return{onError:t}}},6673:function(e,t,n){var r=n(30686);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return!t||"object"!==c(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=u(e);if(t){var o=u(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return a(this,n)}}var l=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(n,e);var t=s(n);function n(){var e;return o(this,n),(e=t.apply(this,arguments))._handleLayoutReady=function(t){e.setLayout=t,e.on("change-layout",t)},e._handleExcalidrawReady=function(t){e.api=t},e}var r=n.prototype;return r.init=function(){this.on("layout-ready",this._handleLayoutReady),this.on("excalidraw-ready",this._handleExcalidrawReady)},r.dispose=function(){this.api=void 0,this.removeAllListeners()},n}(r.v);t.Z=new l},97184:function(e,t,n){n.d(t,{Sh:function(){return E},ZP:function(){return S}});var r,o=n(52322),u=n(2784),a=n(18149),i=n.n(a),c=n(5632),s=n(6673),l=n(19605),f=n(41573),d=n(65545),v=n(50639),p=n(23365),y=n(10559),b=n(7878),m="layout-sizes",h=[1,1],w=y.X.Document;var g=function(){var e=(0,l.K)(),t=(0,v.d)(),n=(0,c.useRouter)().route,o=(0,u.useState)(0),a=o[0],g=o[1],k=(0,u.useState)(function(e,t,n){var r=e.layout,o=e.element,u=e.elements,a=(0,f.ZP)();return"string"===typeof r&&(0,d.$d)(r)?r:o||u?y.X.Canvas:(null===a||void 0===a?void 0:a.hasFigureEmbed)?y.X.Document:(null===a||void 0===a?void 0:a.hasDrawing)===(null===a||void 0===a?void 0:a.hasNotes)?n?y.X.Canvas:t?w:y.X.Both:(null===a||void 0===a?void 0:a.hasDrawing)?y.X.Canvas:y.X.Document}(e,t,n.endsWith("/embed"))),O=k[0],I=k[1],E=(0,u.useState)((r||(r=b.J.getItem(m)||h),r)),S=E[0],P=E[1],j=(0,p.D9)(S),C=(0,p.D9)(O);(0,u.useEffect)((function(){null==O||i()(O,C)||b.J.setItem("layout-mode",O)}),[O,C]),(0,u.useEffect)((function(){null==S||i()(S,j)||b.J.setItem(m,S)}),[S,j]),(0,u.useEffect)((function(){t&&O===y.X.Both&&I(w)}),[t,O]);var x=(0,u.useMemo)((function(){return function(e){switch(e){case y.X.Canvas:return[!1,!0];case y.X.Document:return[!0,!1];default:return[!0,!0]}}(O)}),[O]);return(0,u.useEffect)((function(){s.Z.emit("layout-ready",I)}),[]),{sizes:S,visibilities:x,setSizes:P,setLayout:I,offsetTop:a,setOffsetTop:g,layout:O}};function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){k(e,t,n[t])}))}return e}var I=(0,u.createContext)(void 0),E=function(e){var t=e.children,n=g(),r=(0,u.useState)(!1),a=r[0],i=r[1],c=(0,u.useState)(!1),s=c[0],l=c[1],f=(0,u.useState)(!1),d=f[0],v=f[1],p=(0,u.useState)(!0),y=p[0],b=p[1],m=(0,u.useState)(!0),h=m[0],w=m[1],k=(0,u.useCallback)((function(){i((function(e){return!e}))}),[]);return(0,o.jsx)(I.Provider,{value:O({},n,{isNotepadReady:s,isWhiteboardReady:d,isWhiteboardEmpty:y,isNotepadEmpty:h,isUiHidden:a,toggleUi:k,setNotepadReady:l,setWhiteboardReady:v,setWhiteboardEmpty:b,setNotepadEmpty:w}),children:t})},S=I},77324:function(e,t,n){n.d(t,{X:function(){return E}});var r=n(52322),o=n(2784),u=n(5632),a=n(17003),i=n(94764),c=n(9605),s=n(95585),l=n(83969),f=n(24192),d=n(76687);var v=n(68732),p=n(14898),y=n(57066);var b=n(17366),m=n(66924),h=n(42331),w=n(77432);function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){k(e,t,n[t])}))}return e}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,u=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(u.push(r.value),!t||u.length!==t);a=!0);}catch(c){i=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(i)throw o}}return u}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var E=function(e){var t,n,g=e.workspaceId,k=e.environment,E=void 0===k?"default":k,S=e.externalUserId,P=e.children,j=(0,u.useRouter)(),C=(0,d.Pe)(),x=(0,v.mZ)(),R=(0,v.LP)(),Z=I((0,v.p3)(),2)[1],_=(0,o.useState)({environment:E,getWorkspace:w.Z}),D=_[0],A=_[1],T=(0,p.II)(),W=S||T,X=(0,p.g5)();(0,o.useEffect)((function(){A({environment:E,getWorkspace:w.Z}),F.current=!1}),[E,g]),(0,o.useEffect)((function(){var e={next:function(e){A((function(t){return O({},t,{workspace:e,error:void 0})}))},error:function(e){A((function(t){return O({},t,{workspace:null,error:e})}))}};return C.workspaces.getWorkspaceDataStream({workspaceId:g}).subscribe(e)}),[g]);var N=function(e){var t=e.teamId,n=e.workspaceId,r=(0,d.Pe)(),u=(0,a.f)(r.workspaces.getWorkspaceTeamInfo),i=u.execute,c=u.loading,s=u.result;return(0,o.useEffect)((function(){t&&n&&i(t,n)}),[t,n,i]),{loading:c,teamInfo:s}}({workspaceId:g,teamId:null===(t=D.workspace)||void 0===t?void 0:t.teamId}).teamInfo,B=function(e){var t=(0,d.Pe)(),n=(0,o.useState)({result:null,loading:!0,error:null}),r=n[0],u=n[1],a=(0,o.useRef)(r);a.current=r;var i=(0,p.II)(),c=(0,o.useCallback)((function(e,n,r){e&&n&&(a.current.loading=!0,u((function(e){return{result:r?null:e.result,loading:!0,error:null}})),t.workspaces.validateAccess(n).then((function(e){u({result:e,loading:!1})})).catch((function(e){u({error:e,loading:!1,result:null})})))}),[]);return(0,o.useEffect)((function(){c(i,e,!0)}),[i,e,c]),(0,o.useEffect)((function(){if(e&&i){var t=y.Fs.ref("workspaces/".concat(e,"/userAccess/").concat(i)),n=y.Fs.ref("workspaces/".concat(e,"/publicAccess")),r=function(t){var n,r,o=null===t||void 0===t?void 0:t.val(),u=a.current;o||u.loading||((null===(n=a.current.result)||void 0===n?void 0:n.read)||(null===(r=a.current.result)||void 0===r?void 0:r.write))&&c(i,e,!1)};return t.on("value",r),n.on("value",r),function(){t.off("value",r),n.on("value",r)}}}),[c,e,i]),r}(g),J=B.result,M=B.error,L=function(e,t,n){var r=(0,d.Pe)(),u=(0,o.useState)(),a=u[0],i=u[1],c=void 0!==t,s=null===t||void 0===t?void 0:t.id,l=null===t||void 0===t?void 0:t.teamId;return(0,o.useEffect)((function(){if(c&&e&&s&&l)return r.workspaces.getIsWorkspaceMemberDataStream({workspaceId:s,teamId:l,memberId:e}).subscribe(i,m.Tb);i(!1)}),[s,l,e,c]),(0,o.useMemo)((function(){if(void 0!==a&&null!=n)return{isMember:a,hasAccess:n.read,isReadOnly:n.read&&!n.write}}),[a,n])}(W,D.workspace,J);(0,o.useEffect)((function(){A((function(e){return O({},e,{access:L,teamInfo:N,showTeamJoinBanner:!!(null===N||void 0===N?void 0:N.canJoinTeam)})}))}),[L,N]);var F=(0,o.useRef)(!1),U=(0,a.Z)(C.workspaces.markWorkspaceAsVisited),z=j.pathname.includes("/image");(0,o.useEffect)((function(){var e=D.workspace;if(!F.current&&e&&W&&!X&&!z){var t=e.id;U.execute({workspaceId:t}).catch(m.Tb),F.current=!0}}),[W,D.workspace,U,X,z]),(0,b.Z)((function(){var e=D.workspace;e&&R&&e.teamId&&e.teamId!==R&&x.has(e.teamId)&&Z(e.teamId)}),[D,R,x,Z]);var $=function(e){var t=e.workspaceId,n=e.userId,r=(0,d.Pe)(),u=(0,c.Z)(),a=(0,s.Z)(),v=(0,o.useState)(0),p=v[0],y=v[1],b=(0,o.useCallback)((function(){return y((function(e){return e+1}))}),[]),m=(0,f.O)().onError,h=(0,o.useMemo)((function(){if(n&&t){var e=(0,i.x0)(),o=r.makeNotesAccessor({workspaceId:t,userId:n,clientId:e});return new l.W({userId:n,clientId:e,adapter:o,onError:m,onConnectionChange:function(e){e&&u.success("Connection to server re-established.",{id:"connection"}),a()}})}}),[t,n,a,p]),w=null===h||void 0===h?void 0:h.isReady;return(0,o.useEffect)((function(){if(w)return w?function(){null===h||void 0===h||h.destroy()}:void 0;null===h||void 0===h||h.getInitialData().then(a)}),[h,w,a]),{collab:w?h:void 0,restartCollab:b}}({userId:W,workspaceId:g}),H=$.collab,K=$.restartCollab;(0,o.useEffect)((function(){var e;(null===(e=D.workspace)||void 0===e?void 0:e.duplicatedFrom)&&K()}),[null===(n=D.workspace)||void 0===n?void 0:n.duplicatedFrom,K]);var V=(0,o.useCallback)((function(){A((function(e){return O({},e,{showTeamJoinBanner:!1})}))}),[]),q=(0,o.useMemo)((function(){return O({},D,{slateCollab:H,restartSlateCollab:K,hideTeamJoinBanner:V,getWorkspace:w.Z})}),[D,H,K,V]);return J||M?(0,r.jsx)(h.e.Provider,{value:q,children:P}):null}},77432:function(e,t,n){var r=n(94776),o=n.n(r),u=n(67405),a=n(3213);function i(e,t,n,r,o,u,a){try{var i=e[u](a),c=i.value}catch(s){return void n(s)}i.done?t(c):Promise.resolve(c).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var u=e.apply(t,n);function a(e){i(u,r,o,a,c,"next",e)}function c(e){i(u,r,o,a,c,"throw",e)}a(void 0)}))}}function s(){return(s=c(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.Z.workspace(t).withConverter(u.Z).get();case 2:return e.abrupt("return",e.sent.data());case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.Z=function(e){return s.apply(this,arguments)}}}]);